@(info: models.admin.EventPrereservationsDetail, prereservationForm: Form[controllers.PrereservationForm], userContext: Option[models.entities.UserContext])(implicit request: be.studiocredo.auth.SecureRequest[_], lang: Lang)
@import helper._
@import views.Bootstrap._
@import play.api.libs.json._

@showVenueLabel(show: models.entities.Show, venue: models.entities.Venue) = {
<h3 class="text-info form-control-static">@HumanDateTime.formatDateTime(show.date)</h3>
<h4 class="text-muted">@venue.name</h4>
}

@base("Pre-reservatie " + info.event.name)(userContext) {

<div class="page-header">
    <h1>Pre-reservatie @info.event.name </h1>
</div>

@request.flash.get("error").map { msg =>
<div class="alert alert-danger">
    @msg
</div>
}

@if(!info.shows.isEmpty) {
    @form(action = controllers.routes.Prereservations.save(info.event.id), 'class -> "form form-horizontal") {

        @globalFormErrors(prereservationForm)
        @defining(info.shows.map{ vs => vs.shows.map{(vs.venue, _)}}.flatten) { venueShows =>
        <fieldset data-ng-controller="CounterInputCtrl" data-ng-init="maxQuota = @info.totalQuota">

            @if(!info.users.isEmpty) {
                @formControlStatic("Gekoppelde gebruikers", 6, 6) {
                    @info.users.map { user =>
                        <a href="#" class="btn btn-default btn-xs" role="button">@user.name</a>
                    }
                }

                @formControlStatic("Gebruikte pre-reservaties", 6, 6) { {{totalUsed()}} / @info.totalQuota }
            }


            @for(((venue, show), index) <- venueShows.zipWithIndex) {
                @counterInput(prereservationForm(s"preres[$index].quantity"), '_label -> showVenueLabel(show, venue),  '_labelcol -> 6, '_inputcol -> 3, 'ngModelIndex -> show.id, 'max -> info.totalQuota, 'class -> "form-control")
                @hiddenInput(prereservationForm(s"preres[$index].show"))
            }
        </fieldset>
        }

        @twFormActions {
            <button type="submit" class="btn btn-primary">Bewaren</button>
            <a class="btn btn-warning" href="@controllers.routes.Application.index">Annuleren</a>
        }
    }

} else {
<div class="well">
    <p><em>Geen voorstellingen gevonden voor dit evenement.</em></p>
    @form(routes.Application.index) {
    <input type="submit" value="Annuleren" class="btn btn-warning">
    }
</div>
}

}
