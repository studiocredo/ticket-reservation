@(orders: List[models.entities.OrderDetail], userContext: Option[models.entities.UserContext])(implicit request: be.studiocredo.auth.SecureRequest[_], lang: Lang)
@import helper._
@import controllers.admin.routes
@import be.studiocredo.util.Money

@orderRow(user: models.entities.User, ticketOrder: models.entities.TicketOrderDetail)= {
    <td>@ticketOrder.order.billingName @if(user.name != ticketOrder.order.billingName){<small>(via @user.name)</small>}</td>
    <td>@showName(ticketOrder.show)</td>
    <td>@ticketOrder.ticketSeatOrders.map(_.ticketSeatOrder.seat.name).sorted.mkString(", ") (@ticketOrder.ticketSeatOrders.length)</td>
    <td>@CurrencyFormat.format(ticketOrder.price)</td>
    <td></td>
}

@base("Mijn bestellingen")(userContext) {

    <div class="page-header">
        <h1>Mijn bestellingen</h1>
    </div>

    <div>
        @if(orders.isEmpty) {
            <p class="disabled">Geen bestellingen gevonden.</p>
        } else {
            <table class="table table-hover table-striped">
                <thead>
                <tr>
                    <th>Datum</th>
                    <th>Naam</th>
                    <th>Voorstelling</th>
                    <th>Plaatsen</th>
                    <th>Prijs</th>
                    <th>Betaling</th>
                </tr>
                </thead>
                <tbody>
                @orders.map { order =>
                @defining(order.ticketOrders match { case head :: tail => (Some(head), tail); case _ => (None, Nil) }) { tuple =>
                @defining(tuple._1) { first =>
                @defining(tuple._2) { tail =>
                    @first match {
                        case Some(first) => {
                            <tr>
                                <td>@HumanDateTime.formatDateCompact(order.order.date)</td>
                                @orderRow(order.user, first)
                            </tr>
                        }
                        case None => {Â }
                    }
                    @tail.map { ticketOrder =>
                    <tr>
                        <td/>
                        @orderRow(order.user, ticketOrder)
                    </tr>
                    }
                }
                }
                }
                }
                </tbody>
            </table>
        }
    </div>
}

