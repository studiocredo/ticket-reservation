@(order: models.entities.OrderDetail, userContext: Option[models.entities.UserContext])(implicit request: be.studiocredo.auth.SecureRequest[_], lang: Lang)
@import helper._
@import views.Bootstrap._
@import models.CurrencyFormat

@orderRow(user: models.entities.User, ticketOrder: models.entities.TicketOrderDetail)= {
<td>@user.name</td>
<td>@showName(ticketOrder.show)</td>
<td>
    @defining(ticketOrder.ticketSeatOrders.map(_.ticketSeatOrder.seat.name).sorted.grouped(5).map(_.mkString(", ")).toSeq) { groupedSeats =>
        @groupedSeats.tail.foldLeft(Html(groupedSeats.head)) { (result, seat) =>
            @result<br/>@seat
        }
    }
</td>
<td>@ticketOrder.ticketSeatOrders.length</td>
<td>@CurrencyFormat.format(ticketOrder.price)</td>
<td>
    <a class="btn btn-primary btn-sm" href="@routes.Orders.viewShow(ticketOrder.show.id)">Wijzigen</a>
    <a class="btn btn-danger btn-sm" href="@routes.Orders.cancelShow(ticketOrder.show.id)">Verwijderen</a>
</td>
}

@base("Bevestig je bestelling")(userContext) {
    <div class="page-header">
        <h1>Overzicht bestelling </h1>
    </div>

    <h2>Facturatie gegevens</h2>
    <address>
        <strong>@order.order.billingName</strong><br>
        @order.order.billingAddress
    </address>

    <h2>Bestelling</h2>
    <table class="table table-hover table-striped">
        <thead>
        <tr>
            <th>Datum</th>
            <th>Naam</th>
            <th>Voorstelling</th>
            <th>Plaatsen</th>
            <th>Aantal</th>
            <th>Prijs</th>
            <th></th>
        </tr>
        </thead>
        <tbody>

        @defining(order.ticketOrders match { case head :: tail => (Some(head), tail); case _ => (None, Nil) }) { tuple =>
        @defining(tuple._1) { first =>
        @defining(tuple._2) { tail =>
        @first match {
        case Some(first) => {
        <tr>
            <td>@HumanDateTime.formatDateCompact(order.order.date)</td>
            @orderRow(order.user, first)
        </tr>
        }
        case None => {Â }
        }
        @tail.map { ticketOrder =>
        <tr>
            <td/>
            @orderRow(order.user, ticketOrder)
        </tr>
        }
        }
        }
        }
        </tbody>
        <tfoot>
            <tr class="success">
            <th colspan="5" class="h3">Totaal</th>
            <th class="h3">@CurrencyFormat.format(order.price)</th>
            <th/>
            </tr>
        </tfoot>
    </table>

    <a class="btn btn-warning btn-lg" data-toggle="modal" data-target="#cancelModal">Annuleren</a>
    @form(action = routes.Orders.confirm(order.order.id), 'class -> "form form-inline form-no-feedback") {
        <button type="submit" class="btn btn-success btn-lg">Bevestigen</button>
    }

    <!-- Modal -->
    <div class="modal fade" id="cancelModal" tabindex="-1" role="dialog" aria-labelledby="cancelModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="cancelModalLabel">Annulatie bestelling</h4>
                </div>
                <div class="modal-body">
                    <p>Weet je zeker dat je je bestelling wil annuleren?</p>
                    <p>Alle aangeduide plaatsen zullen weer worden vrijgegeven. Indien je enkel de plaatsen voor een voorstelling wil wijzigen,
                    gebruik dan de link 'Wijzigen' op de overzichtspagina.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Nee, terug naar overzicht</button>
                    <a class="btn btn-primary" href="@routes.Orders.cancel(order.order.id)">Ja, annuleer mijn bestelling</a>
                </div>
            </div>
        </div>
    </div>


}